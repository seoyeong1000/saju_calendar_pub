#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Conventional Commits 형식 검증
# 형식: <type>(<scope>): <subject>
commit_msg=$(cat "$1")

# 빈 줄로 구분된 첫 번째 줄만 검사 (제목)
subject=$(echo "$commit_msg" | head -n 1)

# 주석으로 시작하는 경우 스킵 (템플릿 사용 시)
if echo "$subject" | grep -qE '^#'; then
  exit 0
fi

# Conventional Commits 형식 검증
if ! echo "$subject" | grep -qE '^(feat|fix|docs|style|refactor|test|chore)(\(.+\))?: .+'; then
  echo "❌ 커밋 메시지가 Conventional Commits 형식을 따르지 않습니다."
  echo ""
  echo "올바른 형식: <type>(<scope>): <subject>"
  echo ""
  echo "예시:"
  echo "  feat: 새로운 기능 추가"
  echo "  fix(auth): 로그인 버그 수정"
  echo "  docs: README 업데이트"
  echo ""
  echo "타입: feat, fix, docs, style, refactor, test, chore"
  exit 1
fi

# 제목 길이 검증 (100자 제한)
if [ ${#subject} -gt 100 ]; then
  echo "❌ 커밋 메시지 제목이 100자를 초과합니다. (현재: ${#subject}자)"
  exit 1
fi

exit 0

